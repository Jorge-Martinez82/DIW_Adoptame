<!doctype html>
<html lang="es">
<head>
	<meta charset="UTF-8" />
	<meta
		name="viewport"
		content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
	/>
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<title>Formulario de adopción</title>
	<link href="../dist/css/styles.css" rel="stylesheet" />
	<link rel="icon" type="image/vnd.microsoft.icon" href="../assets/img/logo.png" />
</head>

<body>
<header class="relative z-10 m-2">
	<nav class="flex items-center justify-between">
		<a href="../index.html" class="flex items-center gap-3">
			<img src="../assets/img/logo.png" alt="logo de adoptame" class="h-10" />
			<p class="font-montserrat font-bold">Adóptame</p>
		</a>

		<div class="absolute left-1/2 hidden -translate-x-1/2 transform sm:block">
			<ul class="flex gap-6 font-roboto">
				<li>
					<a class="underline-offset-1 hover:underline" href="../index.html#about">
						Sobre nosotros
					</a>
				</li>
				<li>
					<a class="underline-offset-1 hover:underline" href="../src/protectoras.html">
						Protectoras
					</a>
				</li>
				<li>
					<a class="underline-offset-1 hover:underline" href="../src/mascotas.html">Mascotas</a>
				</li>
			</ul>
		</div>

		<!-- boton iniciar sesion escritorio -->
		<a
			href="./login.html"
			class="hidden rounded-full border-2 border-customBlue px-6 py-2 font-roboto font-bold text-black transition duration-300 hover:bg-customBlue hover:text-white sm:block"
		>
			Iniciar sesión
		</a>

		<!-- boton menu movil -->
		<button id="menu-btn" class="block sm:hidden">
			<img src="../assets/img/menu_movil.svg" alt="Abrir menú" class="h-8 w-8" />
		</button>
	</nav>

	<!-- menu movil desplegado -->
	<ul
		id="menu"
		class="absolute left-0 top-16 hidden w-full flex-col items-center gap-4 bg-white p-4 shadow-lg sm:hidden"
	>
		<li>
			<a class="underline-offset-1 hover:underline" href="../index.html#about">
				Sobre nosotros
			</a>
		</li>
		<li>
			<a class="underline-offset-1 hover:underline" href="../src/protectoras.html">
				Protectoras
			</a>
		</li>
		<li>
			<a class="underline-offset-1 hover:underline" href="../src/mascotas.html">Mascotas</a>
		</li>
		<li class="w-full text-center">
			<a
				href="./login.html"
				class="block w-full rounded-full border-2 border-customBlue px-6 py-2 font-roboto font-bold text-black transition duration-300 hover:bg-customBlue hover:text-white"
			>
				Iniciar sesión
			</a>
		</li>
	</ul>
</header>

<main>
	<section
		class="relative flex h-svh flex-col items-center justify-center bg-[url('/assets/img/fondo_adopcion.webp')] bg-cover bg-center"
	>
		<div class="absolute inset-0 bg-white/40"></div>

		<div class="relative flex flex-col items-center justify-center">
			<form
				id="formulario"
				class="mx-2 flex flex-col items-center justify-around rounded-3xl bg-black bg-opacity-75 p-10 py-5 font-roboto text-white"
			>
				<h2 id="titulo" class="font-roboto text-lg font-bold md:text-2xl text-white mb-4"></h2>

				<div class="w-full flex gap-4 my-2">
					<div class="w-1/2">
						<label for="nombre" class="font-medium text-white self-start">Nombre</label>
						<input
							type="text"
							id="nombre"
							name="nombre"
							class="w-full pl-4 rounded-3xl bg-white p-2 text-gray-800"
							placeholder="Introduce tu nombre"
							required
						/>
						<small class="block mt-1 pl-4">Ejemplo: Pedro</small>
					</div>
					<div class="w-1/2">
						<label for="apellidos" class="font-medium text-white self-start">Apellidos</label>
						<input
							type="text"
							id="apellidos"
							name="apellidos"
							class="w-full pl-4 rounded-3xl bg-white p-2 text-gray-800"
							placeholder="Introduce tus apellidos"
							required
						/>
						<small class="block mt-1 pl-4">Ejemplo: Alonso González</small>
					</div>
				</div>

				<div class="my-2 w-full">
					<label for="dni" class="font-medium text-white self-start">DNI</label>
					<input
						type="text"
						id="dni"
						name="dni"
						class="w-full pl-4 rounded-3xl bg-white p-2 text-gray-800"
						placeholder="Introduce tu DNI"
						pattern="[0-9]{8}[A-Za-z]{1}"
						onchange="validarDNI()"
						required
					/>
					<small class="block mt-1 pl-4">Ejemplo: 12345678Z</small>
				</div>

				<div class="my-2 w-full">
					<label for="direccion" class="font-medium text-white self-start">Dirección</label>
					<input
						type="text"
						id="direccion"
						name="direccion"
						class="w-full pl-4 rounded-3xl bg-white p-2 text-gray-800"
						placeholder="Introduce tu dirección"
						pattern="[A-Za-z0-9\s]{1,50}"
						required
					/>
					<small class="block mt-1 pl-4">Ejemplo: Calle Falsa 123 10 1D</small>
				</div>

				<div class="w-full flex gap-4 my-2">
					<div class="w-2/3">
						<label for="localidad" class="font-medium text-white  self-start">Localidad</label>
						<input
							type="text"
							id="localidad"
							name="localidad"
							class="w-full pl-4 rounded-3xl bg-white p-2 text-gray-800"
							placeholder="Introduce tu localidad"
							required
						/>
						<small class="block mt-1 pl-4">Ejemplo: Pamplona</small>
					</div>
					<div class="w-1/3">
						<label for="codigo_postal" class="font-medium text-white  self-start">Código Postal</label>
						<input
							type="text"
							id="codigo_postal"
							name="codigo_postal"
							class="w-full pl-4 rounded-3xl bg-white p-2 text-gray-800"
							placeholder="CP"
							pattern="[0-9]{5}"
							required
						/>
						<small class="block mt-1 pl-4">Ejemplo: 31001</small>
					</div>
				</div>

				<label for="provincia" class="font-medium text-white mt-2 self-start">Provincia</label>
				<select
					id="provincia"
					name="provincia"
					class="w-full rounded-3xl bg-white p-2 text-gray-800"
					required
				>
					<option value="">Selecciona tu provincia</option>
					<option value="navarra">Navarra</option>
					<option value="álava">Álava</option>
					<option value="guipúzcoa">Guipúzcoa</option>
					<option value="vizcaya">Vizcaya</option>
				</select>

				<div class="mt-4 flex items-center">
					<input
						type="checkbox"
						id="mayor_edad"
						name="mayor_edad"
						class="h-4 w-4 rounded border-gray-300 text-customBlue focus:ring-customBlue"
						required
					/>
					<label for="mayor_edad" class="ml-2 text-sm font-medium text-white">
						Soy mayor de edad
					</label>
				</div>

				<button
					type="submit"
					class="mt-5 w-40 rounded-full bg-customBlue p-2 text-white transition duration-300 hover:bg-customBlueHover"
				>
					Enviar solicitud
				</button>
			</form>

		</div>
	</section>
</main>

<footer class="bg-customBlack p-4 pl-4 text-white">
	<div class="mb-4 flex flex-col justify-evenly gap-4 sm:flex-row">
		<div class="font-roboto">
			<a href="../index.html" class="mb-4 flex items-center">
				<img src="../assets/img/logo.png" alt="logo de adoptame" class="h-10" />
				<p class="ml-4 font-montserrat text-2xl font-bold">Adóptame, plataforma de adopción</p>
			</a>
			<div class="flex w-full flex-col justify-between sm:flex-row sm:items-center">
				<p class="font-bold">Siguenos en nuestras redes sociales:</p>
				<div class="flex gap-2">
					<img class="h-8 w-8" src="../assets/img/facebook.png" alt="" />
					<img class="h-8 w-8" src="../assets/img/instagram.png" alt="" />
					<img class="h-8 w-8" src="../assets/img/twiter.png" alt="" />
					<img class="h-8 w-8" src="../assets/img/linkedin.png" alt="" />
					<img class="h-8 w-8" src="../assets/img/youtube.png" alt="" />
				</div>
			</div>
		</div>
		<div>
			<p class="font-bold">Horario de atención</p>
			<p>De Lunes a Sábado de 9 a 18 horas</p>
		</div>
		<div>
			<p class="font-bold">Contacto</p>
			<p>948000000</p>
			<p>info@adoptame.es</p>
		</div>
	</div>
	<div class="sm:text-center">
		<span>2024 ©Adóptame - Todos los derechos reservados</span>
	</div>
</footer>

<script src="../assets/js/index.js"></script>
<script>
	const params = new URLSearchParams(window.location.search);
	const idMascota = params.get("id");

	fetch(`${URL_BACKEND}/mascotas/${idMascota}`)
		.then((response) => response.json())
		.then((data) => {
			console.log(data)
			document.getElementById("titulo").textContent = `Solicitud de adopción de ${data.nombre}`;
		});

	const validarDNI = () => {
		const DNI = document.querySelector('#dni').value;
		const letras = 'TRWAGMYFPDXBNJZSQVHLCKE';
		const letra = letras.charAt(parseInt(DNI, 10) % 23);
		if (letra !== DNI.charAt(8).toUpperCase()) {
			alert('El DNI introducido no es válido');
			document.querySelector('#dni').value = '';
		}
	}

	document.getElementById('formulario').addEventListener('submit', (event) => {
		event.preventDefault();
		const nombre = document.getElementById('nombre').value;
		const apellidos = document.getElementById('apellidos').value;
		const dni = document.getElementById('dni').value;
		const direccion = document.getElementById('direccion').value;
		const localidad = document.getElementById('localidad').value;
		const codigo_postal = document.getElementById('codigo_postal').value;
		const provincia = document.getElementById('provincia').value;
		const mayor_edad = document.getElementById('mayor_edad').checked;

		if (!mayor_edad) {
			alert('Debes ser mayor de edad para poder adoptar');
			return;
		}

		const solicitud = {
			nombre,
			apellidos,
			dni,
			direccion,
			localidad,
			codigo_postal,
			provincia,
			idMascota
		};

		fetch(`${URL_BACKEND}/solicitudes`, {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify(solicitud)
		})
			.then((response) => response.json())
			.then((data) => {
				alert('Solicitud enviada correctamente');
				window.location.href = '../index.html';
			})
			.catch((error) => {
				alert('Ha ocurrido un error al enviar la solicitud');
			});
	});
</script>

</body>
</html>
