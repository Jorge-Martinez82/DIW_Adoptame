<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Mascotas</title>
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
		<link href="../dist/css/styles.css" rel="stylesheet" />
	</head>
	<body>
		<header class="relative z-10 m-2">
			<nav class="flex items-center justify-between">
				<a href="../index.html" class="flex items-center gap-3">
					<img src="../assets/img/logo.png" alt="logo de adoptame" class="h-10" />
					<p class="font-montserrat font-bold">Adoptame</p>
				</a>

				<div class="absolute left-1/2 hidden -translate-x-1/2 transform sm:block">
					<ul class="flex gap-6 font-roboto">
						<li>
							<a class="underline-offset-1 hover:underline" href="../index.html#about">
								Sobre nosotros
							</a>
						</li>
						<li>
							<a class="underline-offset-1 hover:underline" href="./protectoras.html">
								Protectoras
							</a>
						</li>
						<li>
							<a class="underline-offset-1 hover:underline" href="./mascotas.html">Mascotas</a>
						</li>
					</ul>
				</div>

				<a
					id="link-iniciar-sesion-pc"
					href="./login.html"
					class="hidden rounded-full border-2 border-customBlue px-6 py-2 font-roboto font-bold text-black transition duration-300 hover:bg-customBlue hover:text-white sm:block"
				>
					Iniciar sesi칩n
				</a>

				<button id="menu-btn" class="block sm:hidden">
					<img src="../assets/img/menu_movil.svg" alt="Abrir men칰" class="h-8 w-8" />
				</button>
			</nav>

			<ul
				id="menu"
				class="absolute left-0 top-16 hidden w-full flex-col items-center gap-4 bg-white p-4 shadow-lg sm:hidden"
			>
				<li>
					<a class="underline-offset-1 hover:underline" href="../index.html#about">
						Sobre nosotros
					</a>
				</li>
				<li>
					<a class="underline-offset-1 hover:underline" href="./protectoras.html">Protectoras</a>
				</li>
				<li>
					<a class="underline-offset-1 hover:underline" href="./mascotas.html">Mascotas</a>
				</li>
				<li class="w-full text-center">
					<a
						id="link-iniciar-sesion-movil"
						href="./login.html"
						class="block w-full rounded-full border-2 border-customBlue px-6 py-2 font-roboto font-bold text-black transition duration-300 hover:bg-customBlue hover:text-white"
					>
						Iniciar sesi칩n
					</a>
				</li>
			</ul>
		</header>

		<main>
			<section class="relative flex h-80 w-full items-center justify-center">
				<!-- Imagen de fondo con opacidad -->
				<div
					class="absolute inset-0 bg-[url('../../assets/img/gato-mascotas.webp')] bg-cover bg-center opacity-30"
				></div>

				<!-- Contenido sobre el fondo -->
				<div class="relative flex w-[90%] max-w-2xl items-end gap-4 rounded-3xl bg-customBlack p-6">
					<div class="flex w-full flex-col gap-4 md:flex-row">
						<div class="w-full">
							<label for="tipo" class="mb-2 block text-sm font-semibold text-white">
								Tipo de mascota
							</label>
							<select id="tipo" class="w-full rounded bg-white p-2 text-gray-800">
								<option value="todos">Perros, gatos, aves...</option>
								<option value="conejos">游냟 Conejos</option>
								<option value="gatos">游냠 Gatos</option>
								<option value="perros">游냤 Perros</option>
								<option value="tortugas">游냑 Tortugas</option>
							</select>
						</div>

						<div class="w-full">
							<label for="provincia" class="mb-2 block text-sm font-semibold text-white">
								Localizaci칩n
							</label>
							<select id="provincia" class="w-full rounded bg-white p-2 text-gray-800">
								<option value="todos">Todas</option>
								<option value="navarra">Navarra</option>
								<option value="치lava">츼lava</option>
								<option value="guip칰zcoa">Guip칰zcoa</option>
								<option value="vizcaya">Vizcaya</option>
							</select>
						</div>

						<div class="self-end">
							<button
								class="rounded-full bg-customBlue px-6 py-2 font-semibold text-white hover:bg-customBlueHover"
								id="buscar"
							>
								Buscar
							</button>
						</div>
					</div>
				</div>
			</section>

			<section class="relative rounded-lg bg-customPurple p-10">
				<div
					class="absolute inset-0 rounded-lg bg-[url('../../assets/img/huellas.png')] bg-cover bg-center opacity-80"
				></div>

				<div class="relative">
					<h2 class="mb-6 text-2xl font-bold text-gray-800" id="cantidad_resultados">
						Sin resultados
					</h2>
					<div
						class="xs:grid-cols-1 grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6"
						id="resultados_mascotas"
					></div>
				</div>
			</section>
		</main>

		<footer class="bg-customBlack p-4 pl-4 text-white">
			<div class="mb-4 flex flex-col justify-evenly gap-4 sm:flex-row">
				<div class="font-roboto">
					<a href="../index.html" class="mb-4 flex items-center">
						<img src="../assets/img/logo.png" alt="logo de adoptame" class="h-10" />
						<p class="ml-4 font-montserrat text-2xl font-bold">Ad칩ptame, plataforma de adopci칩n</p>
					</a>
					<div class="flex w-full flex-col justify-between sm:flex-row sm:items-center">
						<p class="font-bold">Siguenos en nuestras redes sociales:</p>
						<div class="flex gap-2">
							<img class="h-8 w-8" src="../assets/img/facebook.png" alt="" />
							<img class="h-8 w-8" src="../assets/img/instagram.png" alt="" />
							<img class="h-8 w-8" src="../assets/img/twiter.png" alt="" />
							<img class="h-8 w-8" src="../assets/img/linkedin.png" alt="" />
							<img class="h-8 w-8" src="../assets/img/youtube.png" alt="" />
						</div>
					</div>
				</div>
				<div>
					<p class="font-bold">Horario de atenci칩n</p>
					<p>De Lunes a S치bado de 9 a 18 horas</p>
				</div>
				<div>
					<p class="font-bold">Contacto</p>
					<p>948000000</p>
					<p>info@adoptame.es</p>
				</div>
			</div>
			<div class="sm:text-center">
				<span>2024 춸Ad칩ptame - Todos los derechos reservados</span>
			</div>
		</footer>

		<script src="../assets/js/index.js"></script>
		<script>
			const mascotasDiv = document.querySelector('#resultados_mascotas')
			const cantidadResultadosH1 = document.querySelector('#cantidad_resultados')
			const buscarDiv = document.querySelector('#buscar')

			const tipoSelector = document.querySelector('#tipo')
			const provinciaSelector = document.querySelector('#provincia')

			const buscar = () => {
				const idProtectora = new URLSearchParams(window.location.search).get('idProtectora')

				const params = new URLSearchParams()

				if (idProtectora) {
					params.append('idProtectora', idProtectora)
				}
				if (tipoSelector.value !== 'todos') {
					params.append('categoria', tipoSelector.value)
				}
				if (provinciaSelector.value !== 'todos') {
					params.append('provincia', provinciaSelector.value)
				}

				const url = `${URL_BACKEND}/mascotas${params.toString() ? `?${params.toString()}` : ''}`

				fetch(url)
					.then((response) => response.json())
					.then(generarMascotas)
					.catch((error) => console.error('Error al obtener mascotas:', error))
			}

			buscarDiv.addEventListener('click', buscar)

			const generarMascotas = (mascotas) => {
				cantidadResultadosH1.textContent = `${mascotas.length} resultados`

				mascotasDiv.innerHTML = mascotas
					.map(
						(x) => `
							<a href="./detalle_mascota.html?id=${x.id}" class="block h-full" alt="Ver detalle de ${x.nombre}" title="Ver detalle de ${x.nombre}">
								<div class="bg-white shadow-lg rounded-lg p-3 hover:shadow-xl transition">
									<div class="relative">
										<picture>
											${
												x.imagenSmall
													? `	<source
												srcset="../assets/img/mascotas/${x.imagenSmall}"
												media="(max-width: 767px)"
											/>`
													: ''
											}
											<source
												srcset="../assets/img/mascotas/${x.imagen}"
												media="(min-width: 768px)"
											/>
											<img
												src="../assets/img/mascotas/${x.imagen}"
												alt="Imagen de ${x.nombre}"
												title="Imagen de ${x.nombre}"
												class="w-full h-48 object-cover rounded-lg"
												loading="lazy"
											/>
										</picture>
										<div class="absolute top-2 right-2 flex flex-col gap-2">
											<button class="px-1 pt-1 rounded-full bg-red-500 hover:bg-red-700 text-white" onclick="favoritos(event)" title="A침adir a favoritos" alt="A침adir a favoritos">
											<span class="material-icons">favorite</span>
										</button>

										<button class="px-1 pt-1 rounded-full bg-customBlue hover:bg-customBlueHover text-white" onclick="compartir(event)" title="Compartir" alt="Compartir">
											<span class="material-icons">share</span>
										</button>
										</div>
									</div>
									<div class="p-4">
										<h3 class="text-lg font-semibold text-gray-900">${x.nombre}</h3>
										<p class="capitalize">${x.categoria}</p>
										<ul class="mt-2 text-sm text-gray-500">
											<li class="inline"><strong>Edad:</strong> ${x.edad} a침os</li>
											<li class="inline"><strong>Prioridad:</strong> ${x.prioridad}</li>
										</ul>
										<p class="mt-2 text-gray-900 font-medium">${x.protectora}</p>
									</div>
								</div>
							</a>
						`
					)
					.join('')
			}

			const actualizarSelectores = ({ provincia, categoria }) => {
				tipoSelector.value = categoria
				provinciaSelector.value = provincia
			}

			const obtenerValoresURLYRefrescarSelectores = () => {
				const params = new URLSearchParams(window.location.search)

				const provincia = params.get('provincia')
				const categoria = params.get('categoria')

				actualizarSelectores({
					provincia: provincia || 'todos',
					categoria: categoria || 'todos',
				})

				buscar()
			}

			obtenerValoresURLYRefrescarSelectores()

			function favoritos(event) {
				event.preventDefault()
				alert('A침adido a favoritos')
			}

			function compartir(event) {
				event.preventDefault()
				alert('Compartido')
			}
		</script>
	</body>
</html>
